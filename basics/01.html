<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JS 设计模式 | MuYang Hu&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="实践是检验真理的唯一标准">
    <link rel="preload" href="/blog/assets/css/0.styles.1a67f354.css" as="style"><link rel="preload" href="/blog/assets/js/app.7ecebeac.js" as="script"><link rel="preload" href="/blog/assets/js/2.b88e876e.js" as="script"><link rel="preload" href="/blog/assets/js/3.7dbf0cc9.js" as="script"><link rel="prefetch" href="/blog/assets/js/4.20d7ee85.js"><link rel="prefetch" href="/blog/assets/js/5.8d0ad88c.js"><link rel="prefetch" href="/blog/assets/js/6.2b42b8f6.js"><link rel="prefetch" href="/blog/assets/js/7.469f8897.js"><link rel="prefetch" href="/blog/assets/js/8.83eda719.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.1a67f354.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">MuYang Hu's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/basics/" class="nav-link router-link-active">
  前端实录
</a></div><div class="nav-item"><a href="https://github.com/MuYang-Hu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/basics/" class="nav-link router-link-active">
  前端实录
</a></div><div class="nav-item"><a href="https://github.com/MuYang-Hu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JS基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/basics/01.html" aria-current="page" class="active sidebar-link">JS 设计模式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/basics/js面试题.html" class="sidebar-link">前端面试题</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="js-设计模式"><a href="#js-设计模式" class="header-anchor">#</a> JS 设计模式</h1> <h3 id="js-设计模式定义"><a href="#js-设计模式定义" class="header-anchor">#</a> JS 设计模式定义</h3> <p><strong>设计模式的定义：</strong></p> <blockquote><p>在面向对象软件设计过程中针对特定问题的简洁而优雅的解决方案。</p></blockquote> <p>通俗的说，<strong>设计模式的作用是让我们写出可复用和可维护性高的程序</strong>，以简单的生活例子说明:</p> <blockquote><p>假设有一个空房间，我们要日复一日地往里面放一些东西。最简单的办法当然是把这些东西直接扔进去，但是时间久了，就会发现很难从这个房子里找到自己想要的东西，要调整某几样东西的位置也不容易。所以在房间里做一些柜子也许是个更好的选择，虽然柜子会增加我们的成本，但它可以在维护阶段为我们带来好处。使用这些柜子存放东西的规则，或许就是一种模式。
----摘录<a href="https://book.douban.com/subject/26382780/" target="_blank" rel="noopener noreferrer">《JavaScript 设计模式与开发实践》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>如果我们能对放置的东西分类，分成衣服，鞋子，书籍等等类别，然后每个柜子贴上对应类的标签，有序放置，那么下一次找衣服的时候，就能够从“衣服”标签的柜子找自己的“冬天”衣服，然后把“夏天”衣服放进去，整个过程不必关心其他的柜子有什么，所以在查找时间和效率上要快的多。因为有了好的设计模式，能够让我们在开发中以最少的代价去改动它。</p> <p>设计模式是广泛存在的，不局限于一门开发语言，最重要是学习一门设计的思想。</p> <p>在 JavaScript 中并没有<strong>类</strong>这种概念，而是基于原型链的方式去继承。<strong>JS 中的函数属于一等公民</strong>，在 JS 中定义一个对象非常简单（var obj = {}），而基于 JS 中闭包与弱类型等特性，在实现一些设计模式的方式上与众不同。</p> <p>本文基于<a href="https://book.douban.com/subject/26382780/" target="_blank" rel="noopener noreferrer">《JavaScript 设计模式与开发实践》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>一书，总结出几点经验以供网友参考和学习。</p> <h3 id="设计原则"><a href="#设计原则" class="header-anchor">#</a> 设计原则</h3> <p><strong>单一职责原则（SRP）</strong></p> <p><strong>一个对象或方法只做一件事情</strong>。如果一个方法承担了过多的职责，那么在需求的变迁过程中，需要改写这个方法的可能性就越大。</p> <p>应该把<strong>对象或方法划分成较小的粒度</strong>,以最少的代价去改动或者完全不用改动。</p> <p><strong>最少知识原则（LKP）</strong></p> <p>一个软件实体应当尽可能少地与其他实体发生相互作用 。</p> <p>应当尽量减少对象之间的交互。如果两个对象之间不必彼此直接通信，那么这两个对象就不要发生直接的相互联系，可以转交给第三方进行处理。</p> <p><strong>开放-封闭原则（OCP）</strong></p> <p>软件实体（类、模块、函数）等应该是可以扩展的，但是不可修改</p> <p>当需要改变一个程序的功能或者给这个程序增加新功能的时候，<strong>可以使用增加代码的方式</strong>，尽量避免改动程序的源代码，防止影响原系统的稳定</p> <h3 id="什么是设计模式"><a href="#什么是设计模式" class="header-anchor">#</a> <strong>什么是设计模式</strong></h3> <p>学习设计模式，有助于写出可复用和可维护性高的程序</p> <p>设计模式的原则是“<strong>找出程序中变化的地方，并将变化封装起来</strong>”，它的关键是意图，而不是结构。</p> <p>不过要注意，使用不当的话，可能会事倍功半。</p> <h3 id="一、单例模式"><a href="#一、单例模式" class="header-anchor">#</a> 一、单例模式</h3> <p><strong>1. 定义</strong></p> <p>保证一个类仅有一个实例，并<strong>提供一个访问它的全局访问点</strong></p> <p><strong>2. 核心</strong></p> <p>确保只有一个实例，并提供全局访问</p> <p><strong>3. 实现</strong></p> <p>假设要设置一个管理员，<strong>多次调用也仅设置一次</strong>，我们可以<strong>使用闭包缓存一个内部变量</strong>来实现这个单例</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">SetManager</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>manager <span class="token operator">=</span> name
<span class="token punctuation">}</span>

<span class="token class-name">SetManager</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>manager<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> SingletonSetManager <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> manager <span class="token operator">=</span> <span class="token keyword">null</span>

	<span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>manager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SetManager</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 如果第一次创建好示例，那么后面无论调用多少次SingletonSetManager返回的总是manager</span>
		<span class="token keyword">return</span> manager
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">SingletonSetManager</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// a</span>
<span class="token function">SingletonSetManager</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// a</span>
<span class="token function">SingletonSetManager</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// a</span>
</code></pre></div><p>这是比较简单的做法，但是假如我们还要设置一个 HR 呢？就得复制一遍代码了</p> <p>所以，可以改写单例内部，实现地更通用一些</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 提取出通用的单例</span>
<span class="token keyword">function</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> instance <span class="token operator">=</span> <span class="token keyword">null</span>

	<span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			instance <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> instance
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>再进行调用，结果还是一样</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 获取单例</span>
<span class="token keyword">var</span> managerSingleton <span class="token operator">=</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SetManager</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
	<span class="token keyword">return</span> manager
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">managerSingleton</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// a</span>
<span class="token function">managerSingleton</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// a</span>
<span class="token function">managerSingleton</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// a</span>
</code></pre></div><p>这时，我们添加 HR 时，就不需要更改获取单例内部的实现了，仅需要实现添加 HR 所需要做的，再调用即可</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">SetHr</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>hr <span class="token operator">=</span> name
<span class="token punctuation">}</span>

<span class="token class-name">SetHr</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>hr<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> hrSingleton <span class="token operator">=</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> hr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SetHr</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
	<span class="token keyword">return</span> hr
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">hrSingleton</span><span class="token punctuation">(</span><span class="token string">'aa'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// aa</span>
<span class="token function">hrSingleton</span><span class="token punctuation">(</span><span class="token string">'bb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// aa</span>
<span class="token function">hrSingleton</span><span class="token punctuation">(</span><span class="token string">'cc'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// aa</span>
</code></pre></div><p>或者，仅想要创建一个 div 层，不需要将对象实例化，直接调用函数</p> <p>结果为页面中仅有第一个创建的 div</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createPopup</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
	div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> html
	document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>

	<span class="token keyword">return</span> div
<span class="token punctuation">}</span>

<span class="token keyword">var</span> popupSingleton <span class="token operator">=</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> div <span class="token operator">=</span> <span class="token function">createPopup</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
	<span class="token keyword">return</span> div
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
	<span class="token function">popupSingleton</span><span class="token punctuation">(</span><span class="token string">'aaa'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML<span class="token punctuation">,</span>
	<span class="token function">popupSingleton</span><span class="token punctuation">(</span><span class="token string">'bbb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML<span class="token punctuation">,</span>
	<span class="token function">popupSingleton</span><span class="token punctuation">(</span><span class="token string">'bbb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML
<span class="token punctuation">)</span> <span class="token comment">// aaa  aaa  aaa</span>
</code></pre></div><h3 id="二、策略模式"><a href="#二、策略模式" class="header-anchor">#</a> 二、策略模式</h3> <p><strong>1. 定义</strong></p> <p>定义一系列的算法，把它们一个个封装起来，并且使它们可以相互替换。</p> <p><strong>2. 核心</strong></p> <p>将算法的使用和算法的实现分离开来。</p> <p>一个基于策略模式的程序至少由两部分组成：</p> <p>第一个部分是一组策略类，策略类封装了具体的算法，并负责具体的计算过程。</p> <p>第二个部分是环境类 Context，Context 接受客户的请求，随后把请求委托给某一个策略类。要做到这点，说明 Context 中要维持对某个策略对象的引用</p> <p><strong>3. 实现</strong></p> <p>策略模式可以用于组合一系列算法，也可用于组合一系列业务规则</p> <p>假设需要通过成绩等级来计算学生的最终得分，每个成绩等级有对应的加权值。我们可以利用对象字面量的形式直接定义这个组策略</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 加权映射关系</span>
<span class="token keyword">var</span> levelMap <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token constant">S</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
	<span class="token constant">A</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
	<span class="token constant">B</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
	<span class="token constant">C</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 组策略</span>
<span class="token keyword">var</span> scoreLevel <span class="token operator">=</span> <span class="token punctuation">{</span>
	basicScore<span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>

	<span class="token function-variable function">S</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>basicScore <span class="token operator">+</span> levelMap<span class="token punctuation">[</span><span class="token string">'S'</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token function-variable function">A</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>basicScore <span class="token operator">+</span> levelMap<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token function-variable function">B</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>basicScore <span class="token operator">+</span> levelMap<span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token function-variable function">C</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>basicScore <span class="token operator">+</span> levelMap<span class="token punctuation">[</span><span class="token string">'C'</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 调用</span>
<span class="token keyword">function</span> <span class="token function">getScore</span><span class="token punctuation">(</span><span class="token parameter">level</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> scoreLevel<span class="token punctuation">[</span>level<span class="token punctuation">]</span> <span class="token operator">?</span> scoreLevel<span class="token punctuation">[</span>level<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
	<span class="token function">getScore</span><span class="token punctuation">(</span><span class="token string">'S'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">getScore</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">getScore</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">getScore</span><span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">getScore</span><span class="token punctuation">(</span><span class="token string">'D'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token comment">// 90 88 86 84 0</span>
</code></pre></div><p>在组合业务规则方面，比较经典的是表单的验证方法。这里列出比较关键的部分</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 错误提示</span>
<span class="token keyword">var</span> errorMsgs <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">'输入数据格式不正确'</span><span class="token punctuation">,</span>
    minLength<span class="token operator">:</span> <span class="token string">'输入数据长度不足'</span><span class="token punctuation">,</span>
    isNumber<span class="token operator">:</span> <span class="token string">'请输入数字'</span><span class="token punctuation">,</span>
    required<span class="token operator">:</span> <span class="token string">'内容不为空'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 规则集</span>
<span class="token keyword">var</span> rules <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">minLength</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> length<span class="token punctuation">,</span> errorMsg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> errorMsg <span class="token operator">||</span> errorMsgs<span class="token punctuation">[</span><span class="token string">'minLength'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">isNumber</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> errorMsg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token comment">//d+/.test(value)) {</span>
            <span class="token keyword">return</span> errorMsg <span class="token operator">||</span> errorMsgs<span class="token punctuation">[</span><span class="token string">'isNumber'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">required</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> errorMsg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> errorMsg <span class="token operator">||</span> errorMsgs<span class="token punctuation">[</span><span class="token string">'required'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 校验器</span>
<span class="token keyword">function</span> <span class="token function">Validator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">Validator</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
    constructor<span class="token operator">:</span> Validator<span class="token punctuation">,</span>

    <span class="token comment">// 添加校验规则</span>
    <span class="token function-variable function">add</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> rule<span class="token punctuation">,</span> errorMsg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> arg <span class="token operator">=</span> <span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>rule<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'minLength'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> temp <span class="token operator">=</span> rule<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            arg<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>temp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            rule <span class="token operator">=</span> temp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        arg<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>errorMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 进行校验</span>
            <span class="token keyword">return</span> rules<span class="token punctuation">[</span>rule<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 开始校验</span>
    <span class="token function-variable function">start</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// return ret;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 测试数据</span>
<span class="token keyword">function</span> <span class="token function">testTel</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> val<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> validate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Validator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

validate<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">testTel</span><span class="token punctuation">(</span><span class="token string">'ccc'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'isNumber'</span><span class="token punctuation">,</span> <span class="token string">'只能为数字'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 只能为数字</span>
validate<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">testTel</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'required'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 内容不为空</span>
validate<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">testTel</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'minLength:5'</span><span class="token punctuation">,</span> <span class="token string">'最少5位'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 最少5位</span>
validate<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">testTel</span><span class="token punctuation">(</span><span class="token string">'12345'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'minLength:5'</span><span class="token punctuation">,</span> <span class="token string">'最少5位'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> ret <span class="token operator">=</span> validate<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>4. 优缺点</strong></p> <p><strong>优点</strong></p> <p>可以有效地避免多重条件语句，将一系列方法封装起来也更直观，利于维护</p> <p><strong>缺点</strong></p> <p>往往策略集会比较多，我们需要事先就了解定义好所有的情况</p> <h3 id="三、代理模式"><a href="#三、代理模式" class="header-anchor">#</a> 三、代理模式</h3> <p><strong>1. 定义</strong></p> <p>为一个对象提供一个代用品或占位符，以便控制对它的访问</p> <p><strong>2. 核心</strong></p> <p>当客户不方便直接访问一个 对象或者不满足需要的时候，提供一个替身对象 来控制对这个对象的访问，客户实际上访问的是 替身对象。</p> <p>替身对象对请求做出一些处理之后， 再把请求转交给本体对象</p> <p>代理和本体的接口具有一致性，本体定义了关键功能，而代理是提供或拒绝对它的访问，或者在访问本体之前做一 些额外的事情</p> <p><strong>3. 实现</strong></p> <p>代理模式主要有三种：保护代理、虚拟代理、缓存代理</p> <p>保护代理主要实现了访问主体的限制行为，以过滤字符作为简单的例子</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 主体，发送消息</span>
<span class="token keyword">function</span> <span class="token function">sendMsg</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 代理，对消息进行过滤</span>
<span class="token keyword">function</span> <span class="token function">proxySendMsg</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 无消息则直接返回</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> msg <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'deny'</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 有消息则进行过滤</span>
	msg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">''</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">/</span>泥<span class="token operator">/</span>s <span class="token operator">*</span> 煤<span class="token punctuation">)</span> <span class="token operator">/</span> g<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>

	<span class="token function">sendMsg</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">sendMsg</span><span class="token punctuation">(</span><span class="token string">'泥煤呀泥 煤呀'</span><span class="token punctuation">)</span> <span class="token comment">// 泥煤呀泥 煤呀</span>
<span class="token function">proxySendMsg</span><span class="token punctuation">(</span><span class="token string">'泥煤呀泥 煤'</span><span class="token punctuation">)</span> <span class="token comment">// 呀</span>
<span class="token function">proxySendMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// deny</span>
</code></pre></div><p>它的意图很明显，在访问主体之前进行控制，没有消息的时候直接在代理中返回了，拒绝访问主体，这数据保护代理的形式</p> <p>有消息的时候对敏感字符进行了处理，这属于虚拟代理的模式</p> <p>虚拟代理在控制对主体的访问时，加入了一些额外的操作</p> <p>在滚动事件触发的时候，也许不需要频繁触发，我们可以引入函数节流，这是一种虚拟代理的实现</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 函数防抖，频繁操作中不处理，直到操作完成之后（再过 delay 的时间）才一次性处理</span>
<span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	delay <span class="token operator">=</span> delay <span class="token operator">||</span> <span class="token number">200</span>

	<span class="token keyword">var</span> timer <span class="token operator">=</span> <span class="token keyword">null</span>

	<span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> arg <span class="token operator">=</span> arguments

		<span class="token comment">// 每次操作时，清除上次的定时器</span>
		<span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
		timer <span class="token operator">=</span> <span class="token keyword">null</span>

		<span class="token comment">// 定义新的定时器，一段时间后进行操作</span>
		timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span>

<span class="token comment">// 主体</span>
<span class="token keyword">function</span> <span class="token function">scrollHandle</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>type<span class="token punctuation">,</span> <span class="token operator">++</span>count<span class="token punctuation">)</span> <span class="token comment">// scroll</span>
<span class="token punctuation">}</span>

<span class="token comment">// 代理</span>
<span class="token keyword">var</span> proxyScrollHandle <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">debounce</span><span class="token punctuation">(</span>scrollHandle<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

window<span class="token punctuation">.</span>onscroll <span class="token operator">=</span> proxyScrollHandle
</code></pre></div><p>缓存代理可以为一些开销大的运算结果提供暂时的缓存，提升效率</p> <p>来个栗子，缓存加法操作</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 主体</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> arg <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span>

	<span class="token keyword">return</span> arg<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> a <span class="token operator">+</span> b
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 代理</span>
<span class="token keyword">var</span> proxyAdd <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

	<span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> arg <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>

		<span class="token comment">// 如果有，则直接从缓存返回</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>arg<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> cache<span class="token punctuation">[</span>arg<span class="token punctuation">]</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
			<span class="token keyword">return</span> ret
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
	<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

	<span class="token function">proxyAdd</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">proxyAdd</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token comment">// 10 10 100 100</span>
</code></pre></div><h3 id="四、迭代器模式"><a href="#四、迭代器模式" class="header-anchor">#</a> 四、迭代器模式</h3> <p><strong>1. 定义</strong></p> <p>迭代器模式是指提供一种方法顺序访问一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示。</p> <p><strong>2. 核心</strong></p> <p>在使用迭代器模式之后，即使不关心对象的内部构造，也可以按顺序访问其中的每个元素</p> <p><strong>3. 实现</strong></p> <p>JS 中数组的 map forEach 已经内置了迭代器</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index<span class="token punctuation">,</span> arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">,</span> arr<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>不过对于对象的遍历，往往不能与数组一样使用同一的遍历代码</p> <p>我们可以封装一下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">each</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> value

	<span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> obj<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			value <span class="token operator">=</span> <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">break</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			value <span class="token operator">=</span> <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">break</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 0 1</span>
<span class="token comment">// 1 2</span>
<span class="token comment">// 2 3</span>

<span class="token comment">// a 1</span>
<span class="token comment">// b 2</span>
</code></pre></div><p>再来看一个例子，强行地使用迭代器，来了解一下迭代器也可以替换频繁的条件语句</p> <p>虽然例子不太好，但在其他负责的分支判断情况下，也是值得考虑的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> year <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>year <span class="token operator">&lt;=</span> <span class="token number">2000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>year <span class="token operator">&gt;=</span> <span class="token number">2100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">getManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// B</span>
</code></pre></div><p>将每个条件语句拆分出逻辑函数，放入迭代器中迭代</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">year2000</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> year <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>year <span class="token operator">&lt;=</span> <span class="token number">2000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">year2100</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> year <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>year <span class="token operator">&gt;=</span> <span class="token number">2100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">year</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> year <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>year <span class="token operator">&gt;</span> <span class="token number">2000</span> <span class="token operator">&amp;&amp;</span> year <span class="token operator">&lt;</span> <span class="token number">2100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">iteratorYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> ret <span class="token operator">=</span> arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> ret
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> manager <span class="token operator">=</span> <span class="token function">iteratorYear</span><span class="token punctuation">(</span>year2000<span class="token punctuation">,</span> year2100<span class="token punctuation">,</span> year<span class="token punctuation">)</span> <span class="token comment">// B</span>
</code></pre></div><h3 id="五、发布-订阅模式"><a href="#五、发布-订阅模式" class="header-anchor">#</a> 五、发布-订阅模式</h3> <p><strong>1. 定义</strong></p> <p>也称作观察者模式，定义了对象间的一种一对多的依赖关系，当一个对象的状态发 生改变时，所有依赖于它的对象都将得到通知</p> <p><strong>2. 核心</strong></p> <p>取代对象之间硬编码的通知机制，一个对象不用再显式地调用另外一个对象的某个接口。</p> <p>与传统的发布-订阅模式实现方式（将订阅者自身当成引用传入发布者）不同，在 JS 中通常使用注册回调函数的形式来订阅</p> <p><strong>3. 实现</strong></p> <p>JS 中的事件就是经典的发布-订阅模式的实现</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 订阅</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
	<span class="token string">'click'</span><span class="token punctuation">,</span>
	<span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click1'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token boolean">false</span>
<span class="token punctuation">)</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
	<span class="token string">'click'</span><span class="token punctuation">,</span>
	<span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click2'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token boolean">false</span>
<span class="token punctuation">)</span>

<span class="token comment">// 发布</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// click1  click2</span>
</code></pre></div><p>自己实现一下</p> <p>小 A 在公司 C 完成了笔试及面试，小 B 也在公司 C 完成了笔试。他们焦急地等待结果，每隔半天就电话询问公司 C，导致公司 C 很不耐烦。</p> <p>一种解决办法是 AB 直接把联系方式留给 C，有结果的话 C 自然会通知 AB</p> <p>这里的“询问”属于显示调用，“留给”属于订阅，“通知”属于发布</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 观察者</span>
<span class="token keyword">var</span> observer <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token comment">// 订阅集合</span>
	subscribes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

	<span class="token comment">// 订阅</span>
	<span class="token function-variable function">subscribe</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>subscribes<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>subscribes<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 收集订阅者的处理</span>
		<span class="token keyword">typeof</span> fn <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subscribes<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 发布  可能会携带一些信息发布出去</span>
	<span class="token function-variable function">publish</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> type <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">,</span>
			fns <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subscribes<span class="token punctuation">[</span>type<span class="token punctuation">]</span>

		<span class="token comment">// 不存在的订阅类型，以及订阅时未传入处理回调的</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fns <span class="token operator">||</span> <span class="token operator">!</span>fns<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 挨个处理调用</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> fns<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			fns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 删除订阅</span>
	<span class="token function-variable function">remove</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 删除全部</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> type <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>subscribes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">var</span> fns <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subscribes<span class="token punctuation">[</span>type<span class="token punctuation">]</span>

		<span class="token comment">// 不存在的订阅类型，以及订阅时未传入处理回调的</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fns <span class="token operator">||</span> <span class="token operator">!</span>fns<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> fn <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			fns<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 挨个处理删除</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> fns<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>fns<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				fns<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 订阅岗位列表</span>
<span class="token keyword">function</span> <span class="token function">jobListForA</span><span class="token punctuation">(</span><span class="token parameter">jobs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> jobs<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">jobListForB</span><span class="token punctuation">(</span><span class="token parameter">jobs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> jobs<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// A订阅了笔试成绩</span>
observer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'job'</span><span class="token punctuation">,</span> jobListForA<span class="token punctuation">)</span>
<span class="token comment">// B订阅了笔试成绩</span>
observer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'job'</span><span class="token punctuation">,</span> jobListForB<span class="token punctuation">)</span>

<span class="token comment">// A订阅了笔试成绩</span>
observer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'examinationA'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">score</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// B订阅了笔试成绩</span>
observer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'examinationB'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">score</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// A订阅了面试结果</span>
observer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'interviewA'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

observer<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'examinationA'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment">// 100</span>
observer<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'examinationB'</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token comment">// 80</span>
observer<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'interviewA'</span><span class="token punctuation">,</span> <span class="token string">'备用'</span><span class="token punctuation">)</span> <span class="token comment">// 备用</span>

observer<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'job'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'前端'</span><span class="token punctuation">,</span> <span class="token string">'后端'</span><span class="token punctuation">,</span> <span class="token string">'测试'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 输出A和B的岗位</span>

<span class="token comment">// B取消订阅了笔试成绩</span>
observer<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'examinationB'</span><span class="token punctuation">)</span>
<span class="token comment">// A都取消订阅了岗位</span>
observer<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'job'</span><span class="token punctuation">,</span> jobListForA<span class="token punctuation">)</span>

observer<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'examinationB'</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token comment">// 没有可匹配的订阅，无输出</span>
observer<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'job'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'前端'</span><span class="token punctuation">,</span> <span class="token string">'后端'</span><span class="token punctuation">,</span> <span class="token string">'测试'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 输出B的岗位</span>
</code></pre></div><p><strong>4. 优缺点</strong></p> <p><strong>优点</strong></p> <p>一为时间上的解耦，二为对象之间的解耦。可以用在异步编程中与 MV*框架中</p> <p><strong>缺点</strong></p> <p>创建订阅者本身要消耗一定的时间和内存，订阅的处理函数不一定会被执行，驻留内存有性能开销</p> <p>弱化了对象之间的联系，复杂的情况下可能会导致程序难以跟踪维护和理解</p> <h3 id="六、命令模式"><a href="#六、命令模式" class="header-anchor">#</a> 六、命令模式</h3> <p><strong>1. 定义</strong></p> <p>用一种松耦合的方式来设计程序，使得请求发送者和请求接收者能够消除彼此之间的耦合关系</p> <p>命令（command）指的是一个执行某些特定事情的指令</p> <p><strong>2. 核心</strong></p> <p>命令中带有 execute 执行、undo 撤销、redo 重做等相关命令方法，建议显示地指示这些方法名</p> <p><strong>3. 实现</strong></p> <p>简单的命令模式实现可以直接使用对象字面量的形式定义一个命令</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> incrementCommand <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// something</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>不过接下来的例子是一个自增命令，提供执行、撤销、重做功能</p> <p>采用对象创建处理的方式，定义这个自增</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 自增</span>
<span class="token keyword">function</span> <span class="token function">IncrementCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 当前值</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>val <span class="token operator">=</span> <span class="token number">0</span>
	<span class="token comment">// 命令栈</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	<span class="token comment">// 栈指针位置</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>stackPosition <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token punctuation">}</span>

<span class="token class-name">IncrementCommand</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
	constructor<span class="token operator">:</span> IncrementCommand<span class="token punctuation">,</span>

	<span class="token comment">// 执行</span>
	<span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_clearRedo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token comment">// 定义执行的处理</span>
		<span class="token keyword">var</span> <span class="token function-variable function">command</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>val <span class="token operator">+=</span> <span class="token number">2</span>
		<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>

		<span class="token comment">// 执行并缓存起来</span>
		<span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span>

		<span class="token keyword">this</span><span class="token punctuation">.</span>stackPosition<span class="token operator">++</span>

		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token function-variable function">canUndo</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stackPosition <span class="token operator">&gt;=</span> <span class="token number">0</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token function-variable function">canRedo</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stackPosition <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 撤销</span>
	<span class="token function-variable function">undo</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">canUndo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">this</span><span class="token punctuation">.</span>stackPosition<span class="token operator">--</span>

		<span class="token comment">// 命令的撤销，与执行的处理相反</span>
		<span class="token keyword">var</span> <span class="token function-variable function">command</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>val <span class="token operator">-=</span> <span class="token number">2</span>
		<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>

		<span class="token comment">// 撤销后不需要缓存</span>
		<span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 重做</span>
	<span class="token function-variable function">redo</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">canRedo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 执行栈顶的命令</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">[</span><span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>stackPosition<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 在执行时，已经撤销的部分不能再重做</span>
	<span class="token function-variable function">_clearRedo</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>stack <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stackPosition <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 获取当前值</span>
	<span class="token function-variable function">getValue</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>val<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>再实例化进行测试，模拟执行、撤销、重做的操作</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> incrementCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IncrementCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 模拟事件触发，执行命令</span>
<span class="token keyword">var</span> eventTrigger <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token comment">// 某个事件的处理中，直接调用命令的处理方法</span>
	<span class="token function-variable function">increment</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		incrementCommand<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token function-variable function">incrementUndo</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		incrementCommand<span class="token punctuation">.</span><span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token function-variable function">incrementRedo</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		incrementCommand<span class="token punctuation">.</span><span class="token function">redo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

eventTrigger<span class="token punctuation">[</span><span class="token string">'increment'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
eventTrigger<span class="token punctuation">[</span><span class="token string">'increment'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 4</span>

eventTrigger<span class="token punctuation">[</span><span class="token string">'incrementUndo'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>

eventTrigger<span class="token punctuation">[</span><span class="token string">'increment'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 4</span>

eventTrigger<span class="token punctuation">[</span><span class="token string">'incrementUndo'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
eventTrigger<span class="token punctuation">[</span><span class="token string">'incrementUndo'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 0</span>
eventTrigger<span class="token punctuation">[</span><span class="token string">'incrementUndo'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 无输出</span>

eventTrigger<span class="token punctuation">[</span><span class="token string">'incrementRedo'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
eventTrigger<span class="token punctuation">[</span><span class="token string">'incrementRedo'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 4</span>
eventTrigger<span class="token punctuation">[</span><span class="token string">'incrementRedo'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 无输出</span>

eventTrigger<span class="token punctuation">[</span><span class="token string">'increment'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 6</span>
</code></pre></div><p>此外，还可以实现简单的宏命令（一系列命令的集合）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> MacroCommand <span class="token operator">=</span> <span class="token punctuation">{</span>
	commands<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

	<span class="token function-variable function">add</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">command</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>commands<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span>

		<span class="token keyword">return</span> <span class="token keyword">this</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token function-variable function">remove</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">command</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>commands <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>commands<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>commands<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>commands<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>commands<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>commands<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> showTime <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'time'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> showName <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> showAge <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

MacroCommand<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>showTime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>showName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>showAge<span class="token punctuation">)</span>

MacroCommand<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>showName<span class="token punctuation">)</span>

MacroCommand<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// time age</span>
</code></pre></div><h3 id="七、组合模式"><a href="#七、组合模式" class="header-anchor">#</a> 七、组合模式</h3> <p><strong>1. 定义</strong></p> <p>是用小的子对象来构建更大的 对象，而这些小的子对象本身也许是由更小 的“孙对象”构成的。</p> <p><strong>2. 核心</strong></p> <p>可以用树形结构来表示这种“部分- 整体”的层次结构。</p> <p>调用组合对象的 execute 方法，程序会递归调用组合对象下面的叶对象的 execute 方法</p> <p><img src="/blog/assets/img/01-1.f6764701.png" alt="img">)</p> <p>但要注意的是，组合模式不是父子关系，它是一种 HAS-A（聚合）的关系，将请求委托给 它所包含的所有叶对象。基于这种委托，就需要保证组合对象和叶对象拥有相同的 接口</p> <p>此外，也要保证用一致的方式对待列表中的每个叶对象，即叶对象属于同一类，不需要过多特殊的额外操作</p> <p><strong>3. 实现</strong></p> <p>使用组合模式来实现扫描文件夹中的文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 文件夹 组合对象</span>
<span class="token keyword">function</span> <span class="token function">Folder</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
	<span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">null</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token class-name">Folder</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
	constructor<span class="token operator">:</span> Folder<span class="token punctuation">,</span>

	<span class="token function-variable function">add</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		file<span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">this</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>

		<span class="token keyword">return</span> <span class="token keyword">this</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token function-variable function">scan</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 委托给叶对象处理</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token function-variable function">remove</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> file <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 文件 叶对象</span>
<span class="token keyword">function</span> <span class="token function">File</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
	<span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>

<span class="token class-name">File</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
	constructor<span class="token operator">:</span> File<span class="token punctuation">,</span>

	<span class="token function-variable function">add</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件里面不能添加文件'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token function-variable function">scan</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">]</span>
		<span class="token keyword">var</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parent

		<span class="token keyword">while</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			name<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
			parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>parent
		<span class="token punctuation">}</span>

		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' / '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>构造好组合对象与叶对象的关系后，实例化，在组合对象中插入组合或叶对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> web <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Folder</span><span class="token punctuation">(</span><span class="token string">'Web'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> fe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Folder</span><span class="token punctuation">(</span><span class="token string">'前端'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> css <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Folder</span><span class="token punctuation">(</span><span class="token string">'CSS'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> js <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Folder</span><span class="token punctuation">(</span><span class="token string">'js'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> rd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Folder</span><span class="token punctuation">(</span><span class="token string">'后端'</span><span class="token punctuation">)</span>

web<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fe<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rd<span class="token punctuation">)</span>

<span class="token keyword">var</span> file1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">'HTML权威指南.pdf'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> file2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">'CSS权威指南.pdf'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> file3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">'JavaScript权威指南.pdf'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> file4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">'MySQL基础.pdf'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> file5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">'Web安全.pdf'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> file6 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">'Linux菜鸟.pdf'</span><span class="token punctuation">)</span>

css<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>file2<span class="token punctuation">)</span>
fe<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>file1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>file3<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>css<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>js<span class="token punctuation">)</span>
rd<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>file4<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>file5<span class="token punctuation">)</span>
web<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>file6<span class="token punctuation">)</span>

rd<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>file4<span class="token punctuation">)</span>

<span class="token comment">// 扫描</span>
web<span class="token punctuation">.</span><span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>扫描结果为</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARQAAABmCAYAAAAK7W4HAAAZA0lEQVR4Ae2dTchV1ffHzy8eC+llkGFZFimaYtDLIAeOpHAQ0cvASUFEYJOkQQ5CCJHIIJ00CB0J4cSRRBEiJDlw0CCJ3iiiQUmmUWQUWqIN/n8+J79P61nufc4+9577eO9z1wbdb2utvfd37732yz17Pf9btWrV/1XhAoFAIBDoAYFrepARIgKBQCAQqBEIhRIDIRAIBHpDIBRKb1CGoEAgEAiFEmMgEAgEekMgFEpvUIagQCAQmHiF8v777yd70af7uGVqyrN0kxTuo02SId+236bZsGhSaSV5ogl/MhGYmcxq/1frJ598smLw4sv5OOmeLkUDXS5dsifNpz0pZ/FK5ds0j53N82GVJ/mK5+hsunhsWoQnC4GsQnn++eer++67r3r55ZdnW5RKm828HHjrrbeqL7/8snrnnXd8VlH8gQceqLZu3Vrt3bu3+vzzz7M8fqA2xTVQ5WeFDpDx+OOPV48++mj15ptvVj/++GNSwl133VVt3769OnLkSPXBBx/UNK+++mrtg9Vzzz1XLVq0aA7ve++9V91+++3VvffeW+3Zs6fGAmxvuOGG6vXXX68eeeSRK/pnjoDLEdoMNrbtTVh5GZ7W5ysuOlsOeT5Omq+PZPTlp8YQ/SSc//rrr1lM+yoz5PyLwMySJUuqs2fPFuPx22+/FdMOQvjYY49VJ0+ebFQmyE0N1KbyNOAtr02z4SY5Pu/hhx+uTpw4kVUmnt7HUTD8YxKgvA8dOjRH6TD477zzzlm28+fPz4ZTAdsOwqU4pehS/Dn5nt/yWh7V2ad5ftH15dNPhw8fHnih66seC13OzN9//51sI4rjuuuuq1hdUysvu5Wnnnqq5v3111/rVVN0K1asqCcGq+4nn3xSvfHGG8kyfCKT6u677653Jz4vFfeDEho7MO2gtumeLiW7JI1VD4w++uijEvLONLfcckv1888/V/fcc09F+KeffqrWrl1b3XzzzVlZaqdte5bYZHgsJUckkqd0xcknzfOLT75oxE+6ZLTxSga7OvBet25dvaP7/vvvZ3fQjNMdO3ZUS5curclRxHLkwTfqxVDlTbM/c+HChcb2M3i1XWcLjmMiPfTQQ9VLL71UKxs6mtVVx6Nly5ZV27Ztqwc+adBrq99U2IMPPlixAjcddTy/H6Dka6BaWqVZ3+bbsJVp032YI+Hp06eTCtfToly3bNlS/1MeyrbJXbp0qfr666/rYw8ThSPT8uXLm1jqvNIJagWlJrzNbwuXYGbLUD+0yfX5q1atqnbt2lX9/vvvtQJhYeN4zThjZ/vCCy/Uuz2OzTiOiStXrqzDwr/LIufLj3gzAjOLFy+umpTKmjVrqosXL9arJKLOnDlTn93vuOOO6u23356Vzmoh9/HHH9eTjB0LHc/q2uZYRVBSTJoubpDJg3w7AQYZ3F13U//880+1f//+WcWqO5S2trKDBP8bb7yxshi38ZGvdpVMZOEovwQfyRePr5OVofp439N4GT6OgtWCgwJhkaMvuFs6cOCAJ68VDWNLi2LJwnaFkEgoRmAGjf/VV19dwXDq1Kl6W8kdCxeHHEVYMeVKtHyXrSaXjEycrh1uB2RuYKvO1ve0Nm5lWh4bLr3rsTyDhnVkFJ72TsXLpB3UX77Pz8Utj8XC09s8i5MNw2PpJEM0Xesmfu+zUMUxxqNydeMzf/zxR2MNVq9eXWt+FIrOoXTi5s2b65VBq0VKyP33319df/31FcqpzXF8QHF1damBm5JhJ4zybZoGeYk8JjY7tK67KZVb4lMGu5KuTpPW89m2+jziar/NszzKl3yPk49bOZJv09ro2cFxBGbXkVpk2JVwHD927Fi9C0Y29IxHfs1h3IWbfwRmcpOdo4ocnURnsSrziwYdjAJ47bXXRFLxM6d+Kuayln9s8xkQTUoHAcNcbmqAI6dtkNoJMlvxAQKD7qYGKKqRhbsBtVlYpyYfQqBrar/yoLWYNlbAZHoe1UskNl91UZ6nVXrKX79+/WybGXNqL8dsjbvjx4/XR6AUf6SNFoHsdyjcf3DBJYeykMIgTdtw5cvXxaziJf6wP736MuzgVZ4GbSpPNCU+O4eudz1g+eKLL84R7/HTyiqiFI9Ps/0hvpRvJzDtt3HR2zSFrS+6nA9tn87jI9m5o7Yfn6LH97jZvAj3i0BWofRbTLO0QZSQl+gHtI/nFInSNdG8XB+ftMEppWDbobZaP5dPuuhE47EVjfLxUzTKR14bjWjDnywE/hcW2yarw6K2gcA4IzDxjwPHGdyoWyAwbQjM8MtNuEAgEAgE+kBghm8/wgUCgUAg0AcCceTpA8WQEQgEAjUCoVBiIAQCgUBvCIRC6Q3KEBQIBAITr1By3zv4dB+3Xd+UZ+ki3B8CfWAuGfJt7WyaDYsmlVaSJ5rw0wiMxYdt6aqVpeqjK30sBReDxcZJ83QpmhxvWU0WNhVva3jPhbU4Pu7ry+Umtu+/pvJ83zbRqjzJV9zzpNLF42kj/h8CWYWSMveYSvtP1L+hMAHpEfk3bg1SkZL7hDzN3S3Vl2XfWXWTNDg1j/dKTHmmlIGfzD5ua9WUl6LzSsHH4UFmKt3KGyYs0xX2eYG12zLKsTFMvUt4wwTkZZRKB6YHtfQdkn1rogHlZfUR56Hlxo0bq507d7Y+yuxSnh38Xfg8rcW5y8RNTfAUf06+57e8lkf19WmeX3R9+HocK4Nlfci8WjLCBOQQyGsgDGsCMrejYNXCVIQmM+XJIDYvnmWCkyaU7kJsWdZYM0rupptuqu3X8vRfZj0xEfDKK6/U5gCUpiPP7t27axs2mKnAaWW1q61epMtcoyamndAlXdA2wSUvJZ80z+/LFI34yZfMNl7JyuFBvsWdOFjJYdeF78GEq9In0Q8TkIles4MqkT2b1MUE5CxTImB3LzoqfPbZZ7WtDxQIL5wZbLa8HA/P+dk1MZE1iVVk2+4Fw03Wwj5Ki3KeeeaZ2sQEdbHu2muvrW2SsLKieGTuE1/tSP31gtIJastKTXib3xYu6VNbhpRJm1ybn8MDGrtr1A6V/pAlfmgo0yp5K3tSwmEC0qxEXTqNCdPFoHaTbD+wZGD5iy++qHck2gFYo045HsrR6212CgxS7V5QSN999132KGTNK0pGU73JG8Tcp2Rq0pZMZGhx8q2CkBzJla908ShdvpVBmuis72nEm/NTeGCmMoU7yp9/7F7om1LMc2WPQ3qYgLzcCxpEREsGUV8mINl9PPHEExU7Eo42WtmpB7sSDFox2HDnzp2rB2ATT014+T8GKIN1w4YNI7PMr/KoE3Zd2xw4g6/8NnrlWx7bV8qXb/NsP9owtJZOvKLpWjfxW78UD8uzEMLXlJiAZLDjZAISU438aQcGf5ObLxOQDIDUALF1swNS6RpA3ld+zmewsFvoYrISA0vCK2W0G+PfOBSVNV8I9tBj1Onbb7+dU6UcjyXSXyogDXr+cJjqYemGDdPXbPk1VpBH3Nu/Fda+vFT/WJrUJLc86n/SUmVojMi3sgkrXXJ83NKD38GDB2uL+jbdhi0e4M5ulnHDzhLrhwvVhQnIAXp2EBOQbIV1ucndhi5a2YVY84UoDR15qJosuWFM/N13361r28TjL/90JoeH+xAUjC5KlddkotMfrfhLB/ZuRmYXZYJSsvDZ5utPV1ieFORMYKsgPI3ySE8pDE/v455HikN0Nl91UZ6nVXrKT+GBOVV2iWDHxfY333yTYl0QadnvUBiAYQLyyj5mlelqAhIpTDAuN1POXrCm8lNn6xwP5ZCXc1JkPj+XrnO+p1dc9zOKWz8n09IQthNYisNOcE8jeut7mT7eRSl4Xh9v6ssUHn4ueXlN/eVpxz2eVSjzWfHUhOlavh8wPu4HqOQrXQNZ6TmfweHtw+ZoI70dASkFS6m+sH4un3TRicb3vWiUj5+iUT7y2mhEG/5cBMIE5Fw8IhYIBAJDIDDxjwOHaHuwBgKBQM8IhAnIngENcYHANCMQJiCnufej7YFAzwjEkadnQENcIDDNCIRCmebej7YHAj0jEAqlZ0BDXCAwzQhMvELJfU/g033cdnpTnqWLcDcE+sBVMuTbGtg0GxZNKq0kTzThd0dgLD5s617t/zj0UZM+RiKHgWTjpHm6FE2O97/SIjQIArmJ7fuoSbbvvyZalSf5inueVLp4PG3EyxDIKpTUk+pUmi+GJ/M8mhv0c2IeXpWYDvSDoSmuQSLf13mYOG9dZPSIr2ibnH9no8+0abPe+cBv371gO2P9+vW1WL2X4XP4UifbGyWfwefKyqU31dvWD9zpH4t/U39ZXsKe1ucrLjpbDnk+LpmpdMka1k+NY/suquQd1bB1uBr8YQLyMuoajF07odQEJMqEl8T79++vTRCoHN4GoUCPHj16hRKGh1eqg5oGZFCX2mxBafAS2ZuOzNWhqd4WS8KlEzdFl+LPyff8ltfyCHuf5vlF15fPWDl8+PAV/dyX/HGQEyYgh+gFVhxMOpSYgMSmCU/7u+wuhqhazVpqswXlgOJBqfHwbViniWkndInMtgkueSn5pHl+X6ZoxE++ZLbxShaKlz5ft25dtWjRojm7SXDcsWNHtXTp0prcvhonT+Y/JGsh+tdcuHChsV2Y9tu3b19tx0G2NZhIvLhl5aRzTp48Ocfa1LJly6pt27bVqx12U6AvcdiJOH/+fKdBTfn6pzJSg0Np1iec+ic5bT5K4vTp0622QDWYUvZTOCbJfAE2NthVyElR8eydgdzFUWapzRb6GGdtmaisXB2a6g2vcJacEl8T3fdnCS804rO+5yVPdcMn3tVhSmLXrl31+MeoFLs4HI9cmQvIZKcnhcI1AH1If2DOgXK79mfXOl4t+jABaVapLp3Q5TjBhLVGk3w5MkXAwLS2YJm0mJDQynfo0KHqwIEDRbucLjZbMIKEMaSUa6pDrt5WjiatJrL1LR1hO9GJ28kuOSkeyfR5XgZxX0ZObkqW0qypTBQICy3jAeVC/3iHoqEPt2/fXh05cqSo/7yMSYmHCcjLPaWBRtQO5FxHlh4n4MfAzqVLl2rLazl5pDNB2SUwANnV6XikSc2qxjlc6TlZDN4uNltOnTpVi0Kx5I48TXXw9WYV1iQvwVLtsDy2P5Qv3+ZZ+TYMraUTr2jIU1h5g/hY0+MvE4T7F4EwAWkUSOkA63KcAGYmIyvZpk2b5hxpUoOQSc3ZPOVSpiNTdDJqjZHrEocSQelh25a2NblcHWy9cziS3jSRU3mWRwqCtFQZ5Nt/vh0+z8c9PQqcXWHuyM6uhN0nR1nww8m8I9bsm3alvqyFEg8TkAP0ZJfjhMTzsy0DVOYXSednY3Yk9idjpbMLgV4/GZOuv4sjmTm/9Jcny8+uSGd90vUTNfdEqTowmXL1tnJtmAlsFYTNI6w8hX1+W9wrGcqzzuarLsr3tEpP+eAhevpQO0bdhWEG8vjx40VGu1PyJzkt+x2KtrhqnM7Liue+a2BgdnWDTICmMuzAEZ0GQCpPNCV+1+OElZnDLGcaMkdvZfowq2npL0+eN9V3miyelvGRq7enJW4nMH1g46K3aQpbX3Q5H9o+XQ5//UEzX5afIzYfvKbB0l9WoVgwRh1ODeSuZfrB5OM5RaJ0DfK2csd9YKAAckqgrW2jypdSsPKFt/Vz+aSLTjS+f0WjfPwUjfKR10Yj2vDLEQgTkOVYBWUgEAi0IDDxjwNb2hfZgUAgMI8IhAnIeQQ7igoEFjoCYQJyofdwtC8QmEcE4sgzj2BHUYHAQkcgFMpC7+FoXyAwjwiEQplHsKOoQGChI7AgFQrfH+ifOrDpm4SmPPGPsz9I/QfhGWcMom7jgcBYfNg2DBSpiaGPlqxcfRilPPgUtnS5dEszbmHftrb6qY3y2+gjPxAoRSCrUHhKzzsO+xVrKs0XNF8mIG25KcVg8xUupRN9ic+n7m0mIFM0qTRfXo4GRZByqXTfZqtEuiqiVJm5NJ4opJ7rMz5WrlxZs+U+Yc/JjPTxR6DVHopvwqifancxC+Dr1hS3k02TzKbZcJMcnzfMO6Rz5861Gmfy5SmuNhC3SkL5Svdxy0feKJWKLZswCpJ3RoOatPTyIj5+CMzwHF32MGz1UBx0PisN71e8Y7fCq0qcXsGKbsWKFfWzb57hd1mFuhgtsvVpUwZMmtREsjIGCWuCyKpZTgb4ggVP3YWRpQVjazpQxqtFw0qPtS8ZNvZtEZ33RSd8FE/RtdGIhz7iaT5jgzrpVbLeD9kdCHnWMdYuXryYxMDSRXhyEcgeedQkJoG2rikTkEwQntlzNNLxSCYg4SWNiacBJ7kpfxATkMjJTRRbhlZx69t8Gy6RB32pCUgrW0dC0mQlDYx4+s5rVSYsce0EsU+KYWNeqoIzk9maQJBsKQTF5dMWtSdHA61oxNfk33rrrRVWy6gTCwt2VLC98uyzz9ZsyNKRhwT6n3rLzgv1kHLMGXRqKj/yxheBVoWyZs2aelXBNizuzJkz9URidcJOphx/+kGOyYGi4R+GZ3JGeUSPzwDsYmXM8g4SthNISqaLnEF2U8uXL6+LwCA0BpdQGshhgrLb047Pruzs/rQDwpAP9zX2yJCqeyqNgodts/BBGaDkcNhz2bBhQ7V27dp6x4KJQ+/0ArrkDs7zRnyyEMhavdc2fcmSJbVFKiYBZgzlSo4yKAm2xlptxZvyBzFaZOUwiXLOTiTReHobT9GLT36Xux6UKkoC5YxS4Ei4ePFiicqu1qzs1vkjQ05xWJ5Rh5vs0Y667JA/fghcc/bs2cZarV69etYaupQDk4IdC6trk8MUIWbwUnc0no/jA3KHcSgC/0/ySPcTUIrD++LJ+ShKdmhd68sOBeX6559/Vrfddlu922PLj6V/FFSbAyOvnGkT/+R8G226aEVv40oTPT4KDROIHLVyjjqhMD/88MN6J0scx/FHf04ixxvpCw+B7JFHNjJpMoOe+w0G/YkTJ+r7EAaOPcvbi0Rt33Vh13ZOZuCirLS1L4WZSSBlUMKTUiolfJ6m626Kox+XkVhFl51X7hR++OGHWjSW0jGnqEmtS24ymZQ6WnKstFbEbNvFa9NsvX16V+ysLBYJ9b2t67Fjx+q7EmTTTvLCTRcCWYXCJOBPOMh583Z2YIsGXxezNq0tPMxPr1a2JpVNU1h5fmIpv9Qf9K7H4gK29pIahZsyp+jpUnX07fLxFE9pmu4+PH3uQjVHL37GULiFjUBWocxns+1kKy2XieOVg48jq22CiQdftE11YJJfbdugtp6qv+qsuMXH0ovOYmPTxG/TIhwIlCIQJiBLkQq6QCAQaEVgQT4ObG11EAQCgcBIEAgTkCOBNYQGAtOJQJiAnM5+j1YHAiNBII48I4E1hAYC04lAKJTp7PdodSAwEgRCoYwE1hAaCEwnAqFQeup3/62Hj6eKKaFJ8UVaIDCuCCzY71B4Z8Tn7EePHq3NAoyiA7ooBPvBWBOfpRtFnUNmIDBKBLJfyqaemqfSfOVk72PQz6xRBFu3bq327t1bvyHy8hXnE3jZabGfsSt/Pnw7+VESTXFfH0urvCZFI5qufqrPeOy3fv36WhTvgwb5UrlrPYJ+OhBYsCYgc+9jRtWtTQoilUc9vBIaVd2sXBQ2pih27tzZqLAtT4QDgVIEFoQJSN9YuwLbV9BMppz5Qj3R59Gj3f1geoGjExbKyJP1MQwMySCSL594TolYWmikVLruTnbv3l2/YMZEBM7ap1EdZSHNGr/CfgmvwO1rclunCAcCwyDQeimLGcd9+/bVEyllApJJgfUxu22WCUhWQeymMMBL3KAmIL1sJj71shNJNFhHO336dJ2PtTFeOjc5djp79uypV3UUEvQoE450Uhr4qXCJkkjxNdVHeZiPBGest1mcqePmzZsrTCIgG4WKI/3gwYPVli1balsumETA1klp36jc8AOBJgSydyhiWmgmIK35QsxZlpinRKlg1hIbICgpez/EpNUuw4aVJhy936ZspGg8n42nTG3SHnYf/l5JR0AUSNuf/bBlRDgQ6ILAgjEB2aXRg9Kys7FmMCUnNflTaU30ysNvUzaWljBHNIw3hQsErjYCMyUmINk+c5EnE5CYIWRbzTaalS/n5tsEZK4epenarXjzhazqGzdurPgFizsY7ls4VuUmfiq9ScG01Y9yOapx9ErhDc4cgTjCcUfCMZW+wW3atKn65Zdf2oqI/ECgFwSyRx57accgHkcTkFw6cifAP5x+AmUC6q/T4WO6EqXYZNuWexGZYWQnIvOFTMynn366/p5Fkxk6lIpVEigR4t63vZRSNDafsJXp83w8ZWqTOnLPw/GM492nn35aydq+5494INA3AmPxYduw3670DUpXeVIi8OXCXWRaGTm+Sccs165In2wEsjuU+WyW/YVoPssdtiztOHK7Cu1YKCdHozpIVgmteMIPBMYNgbHYoYwbKFGfQCAQGAyB1u9QBhMbXIFAIDCNCIQJyGns9WhzIDAiBMIE5IiADbGBwDQiEEeeaez1aHMgMCIEQqGMCNgQGwhMIwKhUKax16PNgcCIEAiFMiJgQ2wgMI0I/D8VDg+zhKaK/AAAAABJRU5ErkJggg==" alt="img"></p> <p><strong>4. 优缺点</strong></p> <p><strong>优点</strong></p> <p>可 以方便地构造一棵树来表示对象的部分-整体 结构。在树的构造最终 完成之后，只需要通过请求树的最顶层对 象，便能对整棵树做统一一致的操作。</p> <p><strong>缺点</strong></p> <p>创建出来的对象长得都差不多，可能会使代码不好理解，创建太多的对象对性能也会有一些影响</p> <h3 id="八、模板方法模式"><a href="#八、模板方法模式" class="header-anchor">#</a> 八、模板方法模式</h3> <p><strong>1. 定义</strong></p> <p>模板方法模式由两部分结构组成，第一部分是抽象父类，第二部分是具体的实现子类。</p> <p><strong>2. 核心</strong></p> <p>在抽象父类中封装子类的算法框架，它的 init 方法可作为一个算法的模板，指导子类以何种顺序去执行哪些方法。</p> <p>由父类分离出公共部分，要求子类重写某些父类的（易变化的）抽象方法</p> <p><strong>3. 实现</strong></p> <p>模板方法模式一般的实现方式为继承</p> <p>以运动作为例子，运动有比较通用的一些处理，这部分可以抽离开来，在父类中实现。具体某项运动的特殊性则有自类来重写实现。</p> <p>最终子类直接调用父类的模板函数来执行</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 体育运动</span>
<span class="token keyword">function</span> <span class="token function">Sport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token class-name">Sport</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
	constructor<span class="token operator">:</span> Sport<span class="token punctuation">,</span>

	<span class="token comment">// 模板，按顺序执行</span>
	<span class="token function-variable function">init</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">stretch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">jog</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">deepBreath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token keyword">var</span> free <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token comment">// 运动后还有空的话，就拉伸一下</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>free <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">stretch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 拉伸</span>
	<span class="token function-variable function">stretch</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'拉伸'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 慢跑</span>
	<span class="token function-variable function">jog</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'慢跑'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 深呼吸</span>
	<span class="token function-variable function">deepBreath</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'深呼吸'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 开始运动</span>
	<span class="token function-variable function">start</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'子类必须重写此方法'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 结束运动</span>
	<span class="token function-variable function">end</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'运动结束'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 篮球</span>
<span class="token keyword">function</span> <span class="token function">Basketball</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token class-name">Basketball</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sport</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 重写相关的方法</span>
<span class="token class-name">Basketball</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">start</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'先投上几个三分'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token class-name">Basketball</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">end</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'运动结束了，有事先走一步'</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token comment">// 马拉松</span>
<span class="token keyword">function</span> <span class="token function">Marathon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token class-name">Marathon</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sport</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> basketball <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Basketball</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> marathon <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Marathon</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 子类调用，最终会按照父类定义的顺序执行</span>
basketball<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
marathon<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><img src="/blog/assets/img/01-3.8bd4110f.png" alt="img" style="zoom:150%;"> <h3 id="九、享元模式"><a href="#九、享元模式" class="header-anchor">#</a> 九、享元模式</h3> <p><strong>1. 定义</strong></p> <p>享元（flyweight）模式是一种用于性能优化的模式，它的目标是尽量减少共享对象的数量</p> <p><strong>2. 核心</strong></p> <p>运用共享技术来有效支持大量细粒度的对象。</p> <p>强调将对象的属性划分为内部状态（属性）与外部状态（属性）。内部状态用于对象的共享，通常不变；而外部状态则剥离开来，由具体的场景决定。</p> <p><strong>3. 实现</strong></p> <p>在程序中使用了大量的相似对象时，可以利用享元模式来优化，减少对象的数量</p> <p>举个栗子，要对某个班进行身体素质测量，仅测量身高体重来评判</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 健康测量</span>
<span class="token keyword">function</span> <span class="token function">Fitness</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> age<span class="token punctuation">,</span> height<span class="token punctuation">,</span> weight</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
	<span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex
	<span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age
	<span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> height
	<span class="token keyword">this</span><span class="token punctuation">.</span>weight <span class="token operator">=</span> weight
<span class="token punctuation">}</span>

<span class="token comment">// 开始评判</span>
<span class="token class-name">Fitness</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">judge</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">': '</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">===</span> <span class="token string">'male'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		ret <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">judgeMale</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		ret <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">judgeFemale</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 男性评判规则</span>
<span class="token class-name">Fitness</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">judgeMale</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> ratio <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>weight

	<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">&gt;</span> <span class="token number">20</span> <span class="token operator">?</span> ratio <span class="token operator">&gt;</span> <span class="token number">3.5</span> <span class="token operator">:</span> ratio <span class="token operator">&gt;</span> <span class="token number">2.8</span>
<span class="token punctuation">}</span>

<span class="token comment">// 女性评判规则</span>
<span class="token class-name">Fitness</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">judgeFemale</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> ratio <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>weight

	<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">&gt;</span> <span class="token number">20</span> <span class="token operator">?</span> ratio <span class="token operator">&gt;</span> <span class="token number">4</span> <span class="token operator">:</span> ratio <span class="token operator">&gt;</span> <span class="token number">3</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fitness</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'male'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fitness</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'male'</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fitness</span><span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'female'</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fitness</span><span class="token punctuation">(</span><span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token string">'male'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">170</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fitness</span><span class="token punctuation">(</span><span class="token string">'E'</span><span class="token punctuation">,</span> <span class="token string">'female'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>

<span class="token comment">// 开始评判</span>
a<span class="token punctuation">.</span><span class="token function">judge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// A: false</span>
b<span class="token punctuation">.</span><span class="token function">judge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// B: false</span>
c<span class="token punctuation">.</span><span class="token function">judge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// C: false</span>
d<span class="token punctuation">.</span><span class="token function">judge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// D: true</span>
e<span class="token punctuation">.</span><span class="token function">judge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// E: true</span>
</code></pre></div><p>评判五个人就需要创建五个对象，一个班就几十个对象</p> <p>可以将对象的公共部分（内部状态）抽离出来，与外部状态独立。将性别看做内部状态即可，其他属性都属于外部状态。</p> <p>这么一来我们只需要维护男和女两个对象（使用 factory 对象），而其他变化的部分则在外部维护（使用 manager 对象）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 健康测量</span>
<span class="token keyword">function</span> <span class="token function">Fitness</span><span class="token punctuation">(</span><span class="token parameter">sex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex
<span class="token punctuation">}</span>

<span class="token comment">// 工厂，创建可共享的对象</span>
<span class="token keyword">var</span> FitnessFactory <span class="token operator">=</span> <span class="token punctuation">{</span>
	objs<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

	<span class="token function-variable function">create</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">sex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>objs<span class="token punctuation">[</span>sex<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>objs<span class="token punctuation">[</span>sex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fitness</span><span class="token punctuation">(</span>sex<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>objs<span class="token punctuation">[</span>sex<span class="token punctuation">]</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 管理器，管理非共享的部分</span>
<span class="token keyword">var</span> FitnessManager <span class="token operator">=</span> <span class="token punctuation">{</span>
	fitnessData<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 添加一项</span>
	<span class="token function-variable function">add</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> age<span class="token punctuation">,</span> height<span class="token punctuation">,</span> weight</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> fitness <span class="token operator">=</span> FitnessFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>sex<span class="token punctuation">)</span>

		<span class="token comment">// 存储变化的数据</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>fitnessData<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
			age<span class="token operator">:</span> age<span class="token punctuation">,</span>
			height<span class="token operator">:</span> height<span class="token punctuation">,</span>
			weight<span class="token operator">:</span> weight<span class="token punctuation">,</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> fitness
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 从存储的数据中获取，更新至当前正在使用的对象</span>
	<span class="token function-variable function">updateFitnessData</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> fitnessData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fitnessData<span class="token punctuation">[</span>name<span class="token punctuation">]</span>

		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> item <span class="token keyword">in</span> fitnessData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>fitnessData<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				obj<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">=</span> fitnessData<span class="token punctuation">[</span>item<span class="token punctuation">]</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 开始评判</span>
<span class="token class-name">Fitness</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">judge</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 操作前先更新当前状态（从外部状态管理器中获取）</span>
	FitnessManager<span class="token punctuation">.</span><span class="token function">updateFitnessData</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>

	<span class="token keyword">var</span> ret <span class="token operator">=</span> name <span class="token operator">+</span> <span class="token string">': '</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">===</span> <span class="token string">'male'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		ret <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">judgeMale</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		ret <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">judgeFemale</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 男性评判规则</span>
<span class="token class-name">Fitness</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">judgeMale</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> ratio <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>weight

	<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">&gt;</span> <span class="token number">20</span> <span class="token operator">?</span> ratio <span class="token operator">&gt;</span> <span class="token number">3.5</span> <span class="token operator">:</span> ratio <span class="token operator">&gt;</span> <span class="token number">2.8</span>
<span class="token punctuation">}</span>

<span class="token comment">// 女性评判规则</span>
<span class="token class-name">Fitness</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">judgeFemale</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> ratio <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>weight

	<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">&gt;</span> <span class="token number">20</span> <span class="token operator">?</span> ratio <span class="token operator">&gt;</span> <span class="token number">4</span> <span class="token operator">:</span> ratio <span class="token operator">&gt;</span> <span class="token number">3</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> FitnessManager<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'male'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> FitnessManager<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'male'</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> FitnessManager<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'female'</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> d <span class="token operator">=</span> FitnessManager<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token string">'male'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">170</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> e <span class="token operator">=</span> FitnessManager<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'E'</span><span class="token punctuation">,</span> <span class="token string">'female'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>

<span class="token comment">// 开始评判</span>
a<span class="token punctuation">.</span><span class="token function">judge</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span> <span class="token comment">// A: false</span>
b<span class="token punctuation">.</span><span class="token function">judge</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">)</span> <span class="token comment">// B: false</span>
c<span class="token punctuation">.</span><span class="token function">judge</span><span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">)</span> <span class="token comment">// C: false</span>
d<span class="token punctuation">.</span><span class="token function">judge</span><span class="token punctuation">(</span><span class="token string">'D'</span><span class="token punctuation">)</span> <span class="token comment">// D: true</span>
e<span class="token punctuation">.</span><span class="token function">judge</span><span class="token punctuation">(</span><span class="token string">'E'</span><span class="token punctuation">)</span> <span class="token comment">// E: true</span>
</code></pre></div><p>不过代码可能更复杂了，这个例子可能还不够充分，只是展示了享元模式如何实现，它节省了多个相似的对象，但多了一些操作。</p> <p>factory 对象有点像单例模式，只是多了一个 sex 的参数，如果没有内部状态，则没有参数的 factory 对象就更接近单例模式了</p> <h3 id="十、职责链模式"><a href="#十、职责链模式" class="header-anchor">#</a> 十、职责链模式</h3> <p><strong>1. 定义</strong></p> <p>使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系，将这些对象连成一条链，并沿着这条链 传递该请求，直到有一个对象处理它为止</p> <p><strong>2. 核心</strong></p> <p>请求发送者只需要知道链中的第一个节点，弱化发送者和一组接收者之间的强联系，可以便捷地在职责链中增加或删除一个节点，同样地，指定谁是第一个节点也很便捷</p> <p><strong>3. 实现</strong></p> <p>以展示不同类型的变量为例，设置一条职责链，可以免去多重 if 条件分支</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 定义链的某一项</span>
<span class="token keyword">function</span> <span class="token function">ChainItem</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>fn <span class="token operator">=</span> fn
	<span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>

<span class="token class-name">ChainItem</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
	constructor<span class="token operator">:</span> ChainItem<span class="token punctuation">,</span>

	<span class="token comment">// 设置下一项</span>
	<span class="token function-variable function">setNext</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> next
		<span class="token keyword">return</span> next
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 开始执行</span>
	<span class="token function-variable function">start</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 转到链的下一项执行</span>
	<span class="token function-variable function">toNext</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>next<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'无匹配的执行项目'</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 展示数字</span>
<span class="token keyword">function</span> <span class="token function">showNumber</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> num <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'number'</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token comment">// 转移到下一项</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toNext</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 展示字符串</span>
<span class="token keyword">function</span> <span class="token function">showString</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> str <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'string'</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toNext</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 展示对象</span>
<span class="token keyword">function</span> <span class="token function">showObject</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> obj <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'object'</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toNext</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> chainNumber <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChainItem</span><span class="token punctuation">(</span>showNumber<span class="token punctuation">)</span>
<span class="token keyword">var</span> chainString <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChainItem</span><span class="token punctuation">(</span>showString<span class="token punctuation">)</span>
<span class="token keyword">var</span> chainObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChainItem</span><span class="token punctuation">(</span>showObject<span class="token punctuation">)</span>

<span class="token comment">// 设置链条</span>
chainObject<span class="token punctuation">.</span><span class="token function">setNext</span><span class="token punctuation">(</span>chainNumber<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setNext</span><span class="token punctuation">(</span>chainString<span class="token punctuation">)</span>

chainString<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'12'</span><span class="token punctuation">)</span> <span class="token comment">// string 12</span>
chainNumber<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 无匹配的执行项目</span>
chainObject<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// object {}</span>
chainObject<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span> <span class="token comment">// number 123</span>
</code></pre></div><p>这时想判断未定义的时候呢，直接加到链中即可</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 展示未定义</span>
<span class="token keyword">function</span> <span class="token function">showUndefined</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> obj <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'undefined'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toNext</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> chainUndefined <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChainItem</span><span class="token punctuation">(</span>showUndefined<span class="token punctuation">)</span>
chainString<span class="token punctuation">.</span><span class="token function">setNext</span><span class="token punctuation">(</span>chainUndefined<span class="token punctuation">)</span>

chainNumber<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// undefined</span>
</code></pre></div><p>由例子可以看到，使用了职责链后，由原本的条件分支换成了很多对象，虽然结构更加清晰了，但在一定程度上可能会影响到性能，所以要注意避免过长的职责链。</p> <h3 id="十一、中介者模式"><a href="#十一、中介者模式" class="header-anchor">#</a> 十一、中介者模式</h3> <p><strong>1. 定义</strong></p> <p>所有的相关 对象都通过中介者对象来通信，而不是互相引用，所以当一个对象发生改变时，只需要通知中介者对象即可</p> <p><strong>2. 核心</strong></p> <p>使网状的多对多关系变成了相对简单的一对多关系（复杂的调度处理都交给中介者）</p> <p><img src="/blog/assets/img/01-4.451c3bc6.png" alt="img"></p> <p>使用中介者后</p> <p><img src="/blog/assets/img/01-5.adddbaa6.png" alt="img"></p> <p><strong>3. 实现</strong></p> <p>多个对象，指的不一定得是实例化的对象，也可以将其理解成互为独立的多个项。当这些项在处理时，需要知晓并通过其他项的数据来处理。</p> <p>如果每个项都直接处理，程序会非常复杂，修改某个地方就得在多个项内部修改</p> <p>我们将这个处理过程抽离出来，封装成中介者来处理，各项需要处理时，通知中介者即可。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token constant">A</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
	score<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>

	<span class="token function-variable function">changeTo</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">score</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>score <span class="token operator">=</span> score

		<span class="token comment">// 自己获取</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRank</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

	<span class="token comment">// 直接获取</span>
	<span class="token function-variable function">getRank</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> scores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>score<span class="token punctuation">,</span> <span class="token constant">B</span><span class="token punctuation">.</span>score<span class="token punctuation">,</span> <span class="token constant">C</span><span class="token punctuation">.</span>score<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> a <span class="token operator">&lt;</span> b
		<span class="token punctuation">}</span><span class="token punctuation">)</span>

		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>scores<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>score<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token constant">B</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
	score<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>

	<span class="token function-variable function">changeTo</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">score</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>score <span class="token operator">=</span> score

		<span class="token comment">// 通过中介者获取</span>
		<span class="token function">rankMediator</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token constant">C</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
	score<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>

	<span class="token function-variable function">changeTo</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">score</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>score <span class="token operator">=</span> score

		<span class="token function">rankMediator</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 中介者，计算排名</span>
<span class="token keyword">function</span> <span class="token function">rankMediator</span><span class="token punctuation">(</span><span class="token parameter">person</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> scores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">A</span><span class="token punctuation">.</span>score<span class="token punctuation">,</span> <span class="token constant">B</span><span class="token punctuation">.</span>score<span class="token punctuation">,</span> <span class="token constant">C</span><span class="token punctuation">.</span>score<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> a <span class="token operator">&lt;</span> b
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>scores<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>score<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// A通过自身来处理</span>
<span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">changeTo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>

<span class="token comment">// B和C交由中介者处理</span>
<span class="token constant">B</span><span class="token punctuation">.</span><span class="token function">changeTo</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token constant">C</span><span class="token punctuation">.</span><span class="token function">changeTo</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
</code></pre></div><p>ABC 三个人分数改变后想要知道自己的排名，在 A 中自己处理，而 B 和 C 使用了中介者。B 和 C 将更为轻松，整体代码也更简洁</p> <p>最后，虽然中介者做到了对模块和对象的解耦，但有时对象之间的关系并非一定要解耦，强行使用中介者来整合，可能会使代码更为繁琐，需要注意。</p> <h3 id="十二、装饰者模式"><a href="#十二、装饰者模式" class="header-anchor">#</a> 十二、装饰者模式</h3> <p><strong>1. 定义</strong></p> <p>以动态地给某个对象添加一些额外的职责，而不会影响从这个类中派生的其他对象。</p> <p>是一种“即用即付”的方式，能够在不改变对 象自身的基础上，在程序运行期间给对象动态地 添加职责</p> <p><strong>2. 核心</strong></p> <p>是为对象动态加入行为，经过多重包装，可以形成一条装饰链</p> <p><strong>3. 实现</strong></p> <p>最简单的装饰者，就是重写对象的属性</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token constant">A</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
	score<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token constant">A</span><span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token string">'分数：'</span> <span class="token operator">+</span> <span class="token constant">A</span><span class="token punctuation">.</span>score
</code></pre></div><p>可以使用传统面向对象的方法来实现装饰，添加技能</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">skill</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数学'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 装饰器，还会音乐</span>
<span class="token keyword">function</span> <span class="token function">MusicDecorator</span><span class="token punctuation">(</span><span class="token parameter">person</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>person <span class="token operator">=</span> person
<span class="token punctuation">}</span>

<span class="token class-name">MusicDecorator</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">skill</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>person<span class="token punctuation">.</span><span class="token function">skill</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'音乐'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 装饰器，还会跑步</span>
<span class="token keyword">function</span> <span class="token function">RunDecorator</span><span class="token punctuation">(</span><span class="token parameter">person</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>person <span class="token operator">=</span> person
<span class="token punctuation">}</span>

<span class="token class-name">RunDecorator</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">skill</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>person<span class="token punctuation">.</span><span class="token function">skill</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'跑步'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 装饰一下</span>
<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MusicDecorator</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RunDecorator</span><span class="token punctuation">(</span>person1<span class="token punctuation">)</span>

person<span class="token punctuation">.</span><span class="token function">skill</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 数学</span>
person1<span class="token punctuation">.</span><span class="token function">skill</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 数学 音乐 跑步</span>
</code></pre></div><p>在 JS 中，函数为一等对象，所以我们也可以使用更通用的装饰函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 装饰器，在当前函数执行前先执行另一个函数</span>
<span class="token keyword">function</span> <span class="token function">decoratorBefore</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> beforeFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token function">beforeFn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>

		<span class="token comment">// 在前一个函数中判断，不需要执行当前函数</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">skill</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数学'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">skillMusic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'音乐'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">skillRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'跑步'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> skillDecorator <span class="token operator">=</span> <span class="token function">decoratorBefore</span><span class="token punctuation">(</span>skill<span class="token punctuation">,</span> skillMusic<span class="token punctuation">)</span>
skillDecorator <span class="token operator">=</span> <span class="token function">decoratorBefore</span><span class="token punctuation">(</span>skillDecorator<span class="token punctuation">,</span> skillRun<span class="token punctuation">)</span>

<span class="token function">skillDecorator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 跑步 音乐 数学</span>
</code></pre></div><h3 id="十三、状态模式"><a href="#十三、状态模式" class="header-anchor">#</a> 十三、状态模式</h3> <p><strong>1. 定义</strong></p> <p>事物内部状态的改变往往会带来事物的行为改变。在处理的时候，将这个处理委托给当前的状态对象即可，该状态对象会负责渲染它自身的行为</p> <p><strong>2. 核心</strong></p> <p>区分事物内部的状态，把事物的每种状态都封装成单独的类，跟此种状态有关的行为都被封装在这个类的内部</p> <p><strong>3. 实现</strong></p> <p>以一个人的工作状态作为例子，在刚醒、精神、疲倦几个状态中切换着</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 工作状态</span>
<span class="token keyword">function</span> <span class="token function">Work</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
	<span class="token keyword">this</span><span class="token punctuation">.</span>currentState <span class="token operator">=</span> <span class="token keyword">null</span>

	<span class="token comment">// 工作状态，保存为对应状态对象</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>wakeUpState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WakeUpState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
	<span class="token comment">// 精神饱满</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>energeticState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EnergeticState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
	<span class="token comment">// 疲倦</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>tiredState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TiredState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>

	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token class-name">Work</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>currentState <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>wakeUpState

	<span class="token comment">// 点击事件，用于触发更新状态</span>
	document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>currentState<span class="token punctuation">.</span><span class="token function">behaviour</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 更新工作状态</span>
<span class="token class-name">Work</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">setState</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>currentState <span class="token operator">=</span> state
<span class="token punctuation">}</span>

<span class="token comment">// 刚醒</span>
<span class="token keyword">function</span> <span class="token function">WakeUpState</span><span class="token punctuation">(</span><span class="token parameter">work</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>work <span class="token operator">=</span> work
<span class="token punctuation">}</span>

<span class="token comment">// 刚醒的行为</span>
<span class="token class-name">WakeUpState</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">behaviour</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>work<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">,</span> <span class="token string">'刚醒呢，睡个懒觉先'</span><span class="token punctuation">)</span>

	<span class="token comment">// 只睡了2秒钟懒觉就精神了..</span>
	<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>work<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>work<span class="token punctuation">.</span>energeticState<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 精神饱满</span>
<span class="token keyword">function</span> <span class="token function">EnergeticState</span><span class="token punctuation">(</span><span class="token parameter">work</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>work <span class="token operator">=</span> work
<span class="token punctuation">}</span>

<span class="token class-name">EnergeticState</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">behaviour</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>work<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">,</span> <span class="token string">'超级精神的'</span><span class="token punctuation">)</span>

	<span class="token comment">// 才精神1秒钟就发困了</span>
	<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>work<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>work<span class="token punctuation">.</span>tiredState<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 疲倦</span>
<span class="token keyword">function</span> <span class="token function">TiredState</span><span class="token punctuation">(</span><span class="token parameter">work</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>work <span class="token operator">=</span> work
<span class="token punctuation">}</span>

<span class="token class-name">TiredState</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">behaviour</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>work<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">,</span> <span class="token string">'怎么肥事，好困'</span><span class="token punctuation">)</span>

	<span class="token comment">// 不知不觉，又变成了刚醒着的状态... 不断循环呀</span>
	<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>work<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>work<span class="token punctuation">.</span>wakeUpState<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> work <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Work</span><span class="token punctuation">(</span><span class="token string">'曹操'</span><span class="token punctuation">)</span>
</code></pre></div><p>点击一下页面，触发更新状态的操作</p> <p><img src="/blog/assets/img/01-6.76b8befc.png" alt="img"></p> <p><strong>4. 优缺点</strong></p> <p><strong>优点</strong></p> <p>状态切换的逻辑分布在状态类中，易于维护</p> <p><strong>缺点</strong></p> <p>多个状态类，对于性能来说，也是一个缺点，这个缺点可以使用享元模式来做进一步优化</p> <p>将逻辑分散在状态类中，可能不会很轻易就能看出状态机的变化逻辑</p> <h3 id="十四、适配器模式"><a href="#十四、适配器模式" class="header-anchor">#</a> 十四、适配器模式</h3> <p><strong>1. 定义</strong></p> <p>是解决两个软件实体间的接口不兼容的问题，对不兼容的部分进行适配</p> <p><strong>2. 核心</strong></p> <p>解决两个已有接口之间不匹配的问题</p> <p><strong>3. 实现</strong></p> <p>比如一个简单的数据格式转换的适配器</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 渲染数据，格式限制为数组了</span>
<span class="token keyword">function</span> <span class="token function">renderData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 对非数组的进行转换适配</span>
<span class="token keyword">function</span> <span class="token function">arrayAdapter</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Array]'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> data
	<span class="token punctuation">}</span>

	<span class="token keyword">var</span> temp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> item <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			temp<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> temp
<span class="token punctuation">}</span>

<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token number">0</span><span class="token operator">:</span> <span class="token string">'A'</span><span class="token punctuation">,</span>
	<span class="token number">1</span><span class="token operator">:</span> <span class="token string">'B'</span><span class="token punctuation">,</span>
	<span class="token number">2</span><span class="token operator">:</span> <span class="token string">'C'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">renderData</span><span class="token punctuation">(</span><span class="token function">arrayAdapter</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// A B C</span>
</code></pre></div><h3 id="十五、外观模式"><a href="#十五、外观模式" class="header-anchor">#</a> 十五、外观模式</h3> <p><strong>1. 定义</strong></p> <p>为子系统中的一组接口提供一个一致的界面，定义一个高层接口，这个接口使子系统更加容易使用</p> <p><strong>2. 核心</strong></p> <p>可以通过请求外观接口来达到访问子系统，也可以选择越过外观来直接访问子系统</p> <p><strong>3. 实现</strong></p> <p>外观模式在 JS 中，可以认为是一组函数的集合</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 三个处理函数</span>
<span class="token keyword">function</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">doing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'doing'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 外观函数，将一些处理统一起来，方便调用</span>
<span class="token keyword">function</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token function">doing</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 调用init开始执行</span>
<span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 此处直接调用了高层函数，也可以选择越过它直接调用相关的函数</span>
	<span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// start doing end</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/blog/basics/js面试题.html">
        前端面试题
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.7ecebeac.js" defer></script><script src="/blog/assets/js/2.b88e876e.js" defer></script><script src="/blog/assets/js/3.7dbf0cc9.js" defer></script>
  </body>
</html>
